@model web_payrolls.Models.tblAnnouncment
@{
    ViewBag.Title = Resources.Voucher.Announcement;
    ViewBag.Page = Resources.Voucher.Announcement;
}

<style>
    .btn-green{
        background: #28a745;
        color: #fff;
        font-size: 20px;
    }
</style>

@Html.AntiForgeryToken()

<div class="card">
    <div class="card-header">
        <h2 class="card-title text-info card-text" style="font-weight: 600">
            <i class="ti-pencil"></i> @Resources.Voucher.Edit @Resources.Voucher.Announcement
        </h2>
        <hr />
    </div>
    <div class="card-body">      
        <form action="" method="post" id="form-update-announcement">

            @Html.AntiForgeryToken()

            <div class="row">
                
                <div class="col-md-4">
                    
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Title <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title" id="title" class="form-control" required="" placeholder=@Resources.Voucher.Title value="@Model.Title">
                                <div class="help-block"></div>
                            </div>
                        </div>
    
                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Booster <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title_booster" id="title_booster" class="form-control" required="" placeholder=@Resources.Voucher.Booster value="@Model.Title_Booter">
                                <div class="help-block"></div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="text-center">
                                <img id="image_view_no" class="img-fluid img-thumbnail" alt="attachment" width="100%" src="~/Content/Uploads/Announcement/@Model.Picture"  onerror="this.src=src='@Url.Content("~/Content/images/no-image.jpg")'">
                                <input type="file" name="choose_photo" id="choose_photo" style="display: none">
                                <input type="hidden" id="photo" name="photo" value="@Model.Picture"/>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-12">
                            <label><span class="text-danger"></span></label>
                            <div class="controls">
                                <textarea name="desc" id="desc" class="form-control" placeholder=@Resources.Voucher.Description rows="4">@Model.Descr</textarea>
                                <div class="help-block"></div>
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
               

                <div class="col-md-4">
                                    
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Title 1 <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title1" id="title1" class="form-control" required="" placeholder=@Resources.Voucher.Time 1 value="@Model.Title1">
                                <div class="help-block"></div>
                            </div>
                        </div>
                    
                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Booster 2 <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title_booster1" id="title_booster1" class="form-control" required="" placeholder=@Resources.Voucher.Booster 1 value="@Model.Title_Booter1">
                                <div class="help-block"></div>
                            </div>
                        </div>
                
                        <div class="col-md-12">
                            <div class="text-center">
                                <img id="image_view_no1" class="img-fluid img-thumbnail" alt="attachment" width="100%" src="~/Content/Uploads/Announcement/@Model.Picture1"  onerror="this.src=src='@Url.Content("~/Content/images/no-image.jpg")'">
                                <input type="file" name="choose_photo1" id="choose_photo1" style="display: none">
                                <input type="hidden" id="photo1" name="photo1" value="@Model.Picture1"/>
                            </div>
                        </div>
                                        
                        <div class="form-group col-md-12">
                            <label><span class="text-danger"></span></label>
                            <div class="controls">
                                <textarea name="desc1" id="desc1" class="form-control" placeholder=@Resources.Voucher.Description rows="4">@Model.Descr1</textarea>
                                <div class="help-block"></div>
                            </div>
                        </div>
                                        
                    </div>
                                    
                </div>
                
                <div class="col-md-4">
                                    
                    <div class="row">
                        
                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Title <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title2" id="title2" class="form-control" required="" placeholder=@Resources.Voucher.Title 2 value="@Model.Title2">
                                <div class="help-block"></div>
                            </div>
                        </div>

                        <div class="form-group col-md-6">
                            <label>@Resources.Voucher.Booster 2 <span class="text-danger">*</span></label>
                            <div class="controls">
                                <input type="text" name="title_booster2" id="title_booster2" class="form-control" required="" placeholder=@Resources.Voucher.Booster 2 value="@Model.Title_Booter2">
                                <div class="help-block"></div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="text-center">
                                <img id="image_view_no2" class="img-fluid img-thumbnail" alt="attachment" width="100%" src="~/Content/Uploads/Announcement/@Model.Picture2"  onerror="this.src=src='@Url.Content("~/Content/images/no-image.jpg")'">
                                <input type="file" name="choose_photo2" id="choose_photo2" style="display: none">
                                <input type="hidden" id="photo2" name="photo2" value="@Model.Picture2"/>
                            </div>
                        </div>

                        <div class="form-group col-md-12">
                            <label><span class="text-danger"></span></label>
                            <div class="controls">
                                <textarea name="desc2" id="desc2" class="form-control" placeholder=@Resources.Voucher.Description rows="4">@Model.Descr2</textarea>
                                <div class="help-block"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            @Html.Hidden("announcement_id",@Model.PK_Announment_Id)
            
            <div class="text-xs-right">
                <button type="button" class="btn btn-block btn-green" id="btn-update-announcement"><i class="ti-save-alt"></i> @Resources.Voucher.Update @Resources.Voucher.Announcement</button>
            </div>

        </form>
    </div>
</div>


@section Scripts
{
    <script>
    $(function (){
        let control = [
            'announcement_id',
            'title','booster_title','photo', 'desc',
            'title1','booster_title1','photo1', 'desc1',
            'title2','booster_title2','photo2', 'desc2'
        ];
        
        // remove error
        for (let item in control){
            $('#'+ control[item]).onChangeRemoveError('#' + control[item]);
        }
        
        $('#btn-update-announcement').click(function (){
            let form = $('#form-update-announcement').serializeArray();
            
            for (let item in form){
                if (form[item].name === 'desc' || form[item].name === 'desc1' || form[item].name === 'desc2'){
                    $('#desc').onChangeRemoveError('#desc');
                    $('#desc1').onChangeRemoveError('#desc1');
                    $('#desc2').onChangeRemoveError('#desc2');
                }
                else if (form[item].value === ''){
                    $('#'+form[item].name).setClassError('#'+form[item].name);
                    return false;
                }
            }  
            
            $.ajax({
                type: 'POST',
                url: '@Url.Action("Update", "Announcement")',
                data: form, 
                success: function (response){
                    if (response.error){
                        swal({
                           title: "Error",
                           text: response.error,
                           type: "error",
                           timer: 1000
                       });                       
                    }
                    window.location.reload();              
                }
            });
        });
        
        
        function isImage(icon) {
            const ext = ['.jpg', '.jpeg', '.gif', '.png', '.PNG','.JPG','.JPEG'];
            return ext.some(el => icon.endsWith(el));
        }
        
        function showPreview(id, doClick){
              $(id).click(function () {
                 $(doClick).focus().trigger("click");
             });
        }
                           
        showPreview('#image_view_no', '#choose_photo');
        showPreview('#image_view_no1', '#choose_photo1');
        showPreview('#image_view_no2', '#choose_photo2');
        
        // function Upload
        function onUpload(control, imagePreview, imageForSave) {

            $(control).change(function () {

                let fileUpload = $(control).get(0);

                let files = fileUpload.files;                   

                let fileSize = files[0].size / 1024 / 1024;

                let fileType = files[0].name; 

                if (!isImage(fileType)) {

                    $(control).val("");

                    swal({
                        title: "Warning",
                        text: "File must be file Image.",
                        type: "warning",
                    });
                    return false;
                }

                if (fileSize > 5) {

                    $(control).val("");

                    swal({
                        title: "Warning",
                        text: "File size must under 5M",
                        type: "warning",
                    });
                    return false;
                }
                               
                let fileData = new FormData();

                for (let i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                }

                let token = $('input[name="__RequestVerificationToken"]').val();

                fileData.append('path', 'Announcement/');
                fileData.append('__RequestVerificationToken', token);

                $.ajax({
                    type: "POST",
                    url: "/Other/Upload",
                    contentType: false,
                    processData: false,
                    data: fileData,
                    success: function (response) {
                        
                        if (response.message) {
                            $(imagePreview).attr('src', '/Content/Uploads/Announcement/' + response.message);
                            $(imageForSave).val(response.message);
                        }
                       
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
            
        }
        
        onUpload('#choose_photo','#image_view_no','#photo');
        onUpload('#choose_photo1','#image_view_no1','#photo1');
        onUpload('#choose_photo2','#image_view_no2','#photo2');
    });
    </script>
}
